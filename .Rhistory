pR_SP
con <- odbcConnect("POC")
sp_sib_plcmt <- sqlQuery(con, "select * from ca_ods.prtl.sibling_care_days_placed_tghr")
sp_sib_plcmt$rate <- sp_sib_plcmt$care_days_tghr/sp_sib_plcmt$care_days
sp_sib_plcmt <- sp_sib_plcmt[order(sp_sib_plcmt$fiscal_yr),]
n <- length(sp_sib_plcmt$care_days_tghr)
mean_rate <- mean(sp_sib_plcmt$rate[1:n-1])
sp_sib_plcmt$variance <- abs(sp_sib_plcmt$rate - mean_rate)
mean_variance <- mean(sp_sib_plcmt$variance)
sp_sib_plcmt$lcl <- mean_rate-(mean_variance*qnorm(0.997))
sp_sib_plcmt$ucl <- mean_rate+(mean_variance*qnorm(0.997))
#write.csv(sp_sib_plcmt, "rate_sib_plcmt.csv")
sp_sib_plcmt_long <- melt(sp_sib_plcmt[,c("fiscal_yr", "rate", "lcl", "ucl")], id.vars = "fiscal_yr")
levels(sp_sib_plcmt_long$variable) <- c("Sibling Placement Rate"
,"Lower Limit"
,"Upper Limit")
head(sp_sib_plcmt_long)
head(sibs)
data.point.size = 1
paR_OTR <- ggplot(otr[otr$variable!="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value
,group=variable
,colour=variable)) +
geom_line(size= bound.line.size) +
geom_point(data=otr[otr$variable=="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value)
,size= data.point.size) +
geom_smooth(data=otr[otr$variable=="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value)
,fill=NA
,method="lm") +
geom_smooth(fill=NA, method="lm") +
scale_y_continuous(labels = percent) +
labs(x = "", y = 'Percent of Care-Days\n"On-The-Run"'#, title =
) +
scale_color_manual(name="", values=c(poc_colors[c(1,4,2)]), guide = FALSE) +
facet_grid(~age) +
theme_bw(base_size = base.size) +
theme(legend.position = "bottom",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
#ggsave("otr.pdf", plot = paR_OTR, width = 15, height = 5)
ggsave("Graph-7.pdf", plot = paR_OTR, width = 7, height = 2.5)
bound.line.size = 0.3
ggsave("Graph-7.pdf", plot = paR_OTR, width = 7, height = 2.5)
paR_OTR <- ggplot(otr[otr$variable!="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value
,group=variable
,colour=variable)) +
geom_line(size= bound.line.size) +
geom_point(data=otr[otr$variable=="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value)
,size= data.point.size) +
geom_smooth(data=otr[otr$variable=="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value)
,fill=NA
,method="lm") +
geom_smooth(fill=NA, method="lm") +
scale_y_continuous(labels = percent) +
labs(x = "", y = 'Percent of Care-Days\n"On-The-Run"'#, title =
) +
scale_color_manual(name="", values=c(poc_colors[c(1,4,2)]), guide = FALSE) +
facet_grid(~age) +
theme_bw(base_size = base.size) +
theme(legend.position = "bottom",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
#ggsave("otr.pdf", plot = paR_OTR, width = 15, height = 5)
ggsave("Graph-7.pdf", plot = paR_OTR, width = 7, height = 2.5)
bound.line.size = 0.2
paR_OTR <- ggplot(otr[otr$variable!="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value
,group=variable
,colour=variable)) +
geom_line(size= bound.line.size) +
geom_point(data=otr[otr$variable=="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value)
,size= data.point.size) +
geom_smooth(data=otr[otr$variable=="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value)
,fill=NA
,method="lm") +
geom_smooth(fill=NA, method="lm") +
scale_y_continuous(labels = percent) +
labs(x = "", y = 'Percent of Care-Days\n"On-The-Run"'#, title =
) +
scale_color_manual(name="", values=c(poc_colors[c(1,4,2)]), guide = FALSE) +
facet_grid(~age) +
theme_bw(base_size = base.size) +
theme(legend.position = "bottom",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
#ggsave("otr.pdf", plot = paR_OTR, width = 15, height = 5)
ggsave("Graph-7.pdf", plot = paR_OTR, width = 7, height = 2.5)
paR_OTR <- ggplot(otr[otr$variable!="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value
,group=variable
,colour=variable)) +
geom_line(size= 0.1)+ #bound.line.size) +
geom_point(data=otr[otr$variable=="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value)
,size= data.point.size) +
geom_smooth(data=otr[otr$variable=="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value)
,fill=NA
,method="lm") +
geom_smooth(fill=NA, method="lm") +
scale_y_continuous(labels = percent) +
labs(x = "", y = 'Percent of Care-Days\n"On-The-Run"'#, title =
) +
scale_color_manual(name="", values=c(poc_colors[c(1,4,2)]), guide = FALSE) +
facet_grid(~age) +
theme_bw(base_size = base.size) +
theme(legend.position = "bottom",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
#ggsave("otr.pdf", plot = paR_OTR, width = 15, height = 5)
ggsave("Graph-7.pdf", plot = paR_OTR, width = 7, height = 2.5)
ggsave("Graph-7.pdf", plot = paR_OTR, width = 7, height = 2.3)
ggsave("Graph-7.pdf", plot = paR_OTR, width = 8, height = 2.3)
bound.line.size = 0.5
data.line.size = 1.2
paR_OTR <- ggplot(otr[otr$variable!="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value
,group=variable
,colour=variable)) +
geom_line(size= bound.line.size) +
geom_point(data=otr[otr$variable=="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value)
,size= data.point.size) +
geom_smooth(data=otr[otr$variable=="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value)
,fill=NA
,method="lm") +
geom_smooth(fill=NA, method="lm") +
scale_y_continuous(labels = percent) +
labs(x = "", y = 'Percent of Care-Days\n"On-The-Run"'#, title =
) +
scale_color_manual(name="", values=c(poc_colors[c(1,4,2)]), guide = FALSE) +
facet_grid(~age) +
theme_bw(base_size = base.size) +
theme(legend.position = "bottom",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
#ggsave("otr.pdf", plot = paR_OTR, width = 15, height = 5)
ggsave("Graph-7.pdf", plot = paR_OTR, width = 8, height = 2.3)
data.line.size = 1.5
paR_OTR <- ggplot(otr[otr$variable!="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value
,group=variable
,colour=variable)) +
geom_line(size= bound.line.size) +
geom_point(data=otr[otr$variable=="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value)
,size= data.point.size) +
geom_smooth(data=otr[otr$variable=="On-The-Run Rate",]
,aes(x=fiscal_yr
,y=value)
,fill=NA
,method="lm") +
geom_smooth(fill=NA, method="lm") +
scale_y_continuous(labels = percent) +
labs(x = "", y = 'Percent of Care-Days\n"On-The-Run"'#, title =
) +
scale_color_manual(name="", values=c(poc_colors[c(1,4,2)]), guide = FALSE) +
facet_grid(~age) +
theme_bw(base_size = base.size) +
theme(legend.position = "bottom",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
#ggsave("otr.pdf", plot = paR_OTR, width = 15, height = 5)
ggsave("Graph-7.pdf", plot = paR_OTR, width = 8, height = 2.3)
osi = sqlQuery(con, "select
start_date
,date_type
,qry_type
,county_cd
,sum(cnt_referrals) cnt_referrals
,sum(prior_order_cnt_households) prior_order_cnt_households
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior') nth_order
from prtl.rate_referrals_order_specific
group by
start_date
,date_type
,qry_type
,county_cd
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior')
order by
start_date, county_cd, nth_order ")
head(osi)
osi = sqlQuery(con, "select
start_date
,date_type
,qry_type
,county_cd
,sum(cnt_referrals) cnt_referrals
,sum(prior_order_cnt_households) prior_order_cnt_households
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior') nth_order
from CA_ODS.prtl.rate_referrals_order_specific
group by
start_date
,date_type
,qry_type
,county_cd
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior')
order by
start_date, county_cd, nth_order ")
head(osi)
odbcCloseAll()
con = odbcConnect("POC")
osi = sqlQuery(con, "select
start_date
,date_type
,qry_type
,county_cd
,sum(cnt_referrals) cnt_referrals
,sum(prior_order_cnt_households) prior_order_cnt_households
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior') nth_order
from CA_ODS.prtl.rate_referrals_order_specific
group by
start_date
,date_type
,qry_type
,county_cd
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior')
order by
start_date, county_cd, nth_order ")
head(osi)
osi %>% mutate(prior = factor(nth_order, labels = c("0", "1", "2", "3 or More")))
osi %<>% mutate(prior = factor(nth_order, labels = c("0", "1", "2", "3 or More")))
head(osi)
summary(osi)
osi = sqlQuery(con, "select
start_date
,date_type
,qry_type
,county_cd
,sum(cnt_referrals) cnt_referrals
,sum(prior_order_cnt_households) prior_order_cnt_households
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior') nth_order
from CA_ODS.prtl.rate_referrals_order_specific
where county_cd = 0
group by
start_date
,date_type
,qry_type
,county_cd
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior')
order by
start_date, county_cd, nth_order ")
osi %<>% mutate(prior = factor(nth_order, labels = c("0", "1", "2", "3 or More")))
osi %<>% mutate(prior = factor(nth_order, labels = c("0", "1", "2", "3 or More")),
rate = cnt_referrals / prior_order_cnt_households)
ggplot(osi, aes(x = start_date, y = rate, color = prior)) +
geom_point() +
geom_smooth(method = "lm")
osi = sqlQuery(con, "select
start_date
,date_type
,qry_type
,county_cd
,sum(cnt_referrals) cnt_referrals
,sum(prior_order_cnt_households) prior_order_cnt_households
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior') nth_order
from CA_ODS.prtl.rate_referrals_order_specific
where county_cd = 0
and start_date > '2009-02-01'
group by
start_date
,date_type
,qry_type
,county_cd
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior')
order by
start_date, county_cd, nth_order ")
osi %<>% mutate(prior = factor(nth_order, labels = c("0", "1", "2", "3 or More")),
rate = cnt_referrals / prior_order_cnt_households)
ggplot(osi, aes(x = start_date, y = rate, color = prior)) +
geom_point() +
geom_smooth(method = "lm")
ggplot(osi, aes(x = start_date, y = rate, color = prior)) +
geom_point() +
geom_smooth(method = "lm") +
scale_color_manual(values = poc_colors[1:3], name = "Number of Prior Referrals") +
theme_bw(base_size = base.size) +
theme(legend.position = "bottom",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
ggplot(osi, aes(x = start_date, y = rate, color = prior)) +
geom_point() +
geom_smooth(method = "lm") +
scale_color_manual(values = poc_colors[1:4], name = "Number of Prior Referrals") +
theme_bw(base_size = base.size) +
theme(legend.position = "bottom",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
ggplot(osi, aes(x = start_date, y = rate, color = prior)) +
geom_point() +
geom_smooth(method = "lm", fill = NA) +
scale_color_manual(values = poc_colors[1:4], name = "Number of Prior Referrals") +
theme_bw(base_size = base.size) +
theme(legend.position = "bottom",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
osi %<>% mutate(prior = factor(nth_order, labels = c("0", "1", "2", "3 or More")),
rate = cnt_referrals / prior_order_cnt_households * 1000)
ggplot(osi, aes(x = start_date, y = rate, color = prior)) +
geom_point() +
geom_smooth(method = "lm", fill = NA) +
scale_color_manual(values = poc_colors[1:4], name = "Number of Prior Referrals") +
theme_bw(base_size = base.size) +
theme(legend.position = "bottom",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
ggplot(osi, aes(x = start_date, y = rate, color = prior)) +
geom_point() +
geom_smooth(method = "lm", fill = NA) +
scale_color_manual(values = poc_colors[1:4], name = "Number of Prior Referrals") +
labs(x = "", y = "Referral Rate (per 1,000)")
theme_bw(base_size = base.size) +
theme(legend.position = "bottom",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
ggplot(osi, aes(x = start_date, y = rate, color = prior)) +
geom_point() +
geom_smooth(method = "lm", fill = NA) +
scale_color_manual(values = poc_colors[1:4], name = "Number of Prior Referrals") +
labs(x = "", y = "Referral Rate (per 1,000)") +
theme_bw(base_size = base.size) +
theme(legend.position = "bottom",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
ggplot(osi, aes(x = start_date, y = rate, color = prior)) +
geom_point() +
geom_smooth(method = "lm", fill = NA) +
scale_color_manual(values = poc_colors[1:4], name = "Number of Prior Referrals") +
labs(x = "", y = "Referral Rate (per 1,000)") +
theme_bw(base_size = base.size) +
theme(legend.position = "bottom",
legend.direction = "vertical",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
ggplot(osi, aes(x = start_date, y = rate, color = prior)) +
geom_point() +
geom_smooth(method = "lm", fill = NA) +
scale_color_manual(values = poc_colors[1:4], name = "Number of Prior Referrals") +
labs(x = "", y = "Referral Rate (per 1,000)") +
theme_bw(base_size = base.size) +
theme(legend.position = "right",
legend.direction = "vertical",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
ggsave("Graph2.pdf", plot = osi.plot,  width = 6, height = 3.5)
osi.plot = ggplot(osi, aes(x = start_date, y = rate, color = prior)) +
geom_point() +
geom_smooth(method = "lm", fill = NA) +
scale_color_manual(values = poc_colors[1:4], name = "Number of Prior Referrals") +
labs(x = "", y = "Referral Rate (per 1,000)") +
theme_bw(base_size = base.size) +
theme(legend.position = "right",
legend.direction = "vertical",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
ggsave("Graph2.pdf", plot = osi.plot,  width = 6, height = 3.5)
osi.plot = ggplot(osi, aes(x = start_date, y = rate, color = prior)) +
geom_point(size = data.point.size) +
geom_smooth(method = "lm", fill = NA, size = data.line.size) +
scale_color_manual(values = poc_colors[1:4], name = "Number of Prior Referrals") +
labs(x = "", y = "Referral Rate (per 1,000)") +
theme_bw(base_size = base.size) +
theme(legend.position = "right",
legend.direction = "vertical",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
ggsave("Graph-2.pdf", plot = osi.plot,  width = 6, height = 3.5)
data.line.size = 1
osi.plot = ggplot(osi, aes(x = start_date, y = rate, color = prior)) +
geom_point(size = data.point.size) +
geom_smooth(method = "lm", fill = NA, size = data.line.size) +
scale_color_manual(values = poc_colors[1:4], name = "Number of Prior Referrals") +
labs(x = "", y = "Referral Rate (per 1,000)") +
theme_bw(base_size = base.size) +
theme(legend.position = "right",
legend.direction = "vertical",
panel.grid.minor = element_blank(),
strip.background = element_blank(),
axis.title = element_text(size = rel(0.8)))
ggsave("Graph-2.pdf", plot = osi.plot,  width = 6, height = 3.5)
head(osi)
source('C:/Users/gregorp.NEBULA2/Desktop/GitHub/annual_report/spark helper.R')
source('C:/Users/gregorp.NEBULA2/Desktop/GitHub/annual_report/spark helper.R')
spark(osi[, c("start_date", "rate")])
spark(osi[osi$nth_order = "More than 3 Prior", c("start_date", "rate")])
spark(osi[osi$nth_order == "More than 3 Prior", c("start_date", "rate")])
threeplus = spark(osi[osi$nth_order == "More than 3 Prior", c("start_date", "rate")])
ggsave("spark-table2-row4.pdf", threeplus, width = 3, height = 1)
pdfs <- list.files(pattern = "\\.pdf")
lapply(pdfs, embedFonts)
sparktable(osi[osi$nth_order == "More than 3 Prior", c("start_date", "rate")])
osi = sqlQuery(con, "select
start_date
,date_type
,qry_type
,county_cd
,sum(cnt_referrals) cnt_referrals
,sum(prior_order_cnt_households) prior_order_cnt_households
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior') nth_order
from CA_ODS.prtl.rate_referrals_order_specific
where county_cd = 0
and start_date >= '2009-01-01'
group by
start_date
,date_type
,qry_type
,county_cd
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior')
order by
start_date, county_cd, nth_order ")
osi %<>% mutate(prior = factor(nth_order, labels = c("0", "1", "2", "3 or More")),
rate = cnt_referrals / prior_order_cnt_households * 1000)
threeplus = spark(osi[osi$nth_order == "More than 3 Prior", c("start_date", "rate")])
ggsave("spark-table2-row4.pdf", threeplus, width = 3, height = 1)
embedFonts("spark-table2-row4.pdf")
sparktable(osi[osi$nth_order == "More than 3 Prior", c("start_date", "rate")])
threeplus
osi = sqlQuery(con, "select
start_date
,date_type
,qry_type
,county_cd
,sum(cnt_referrals) cnt_referrals
,sum(prior_order_cnt_households) prior_order_cnt_households
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior') nth_order
from CA_ODS.prtl.rate_referrals_order_specific
where county_cd = 0
and start_date > '2009-02-01'
group by
start_date
,date_type
,qry_type
,county_cd
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior')
order by
start_date, county_cd, nth_order ")
osi %<>% mutate(prior = factor(nth_order, labels = c("0", "1", "2", "3 or More")),
rate = cnt_referrals / prior_order_cnt_households * 1000)
threeplus = spark(osi[osi$nth_order == "More than 3 Prior", c("start_date", "rate")])
ggsave("spark-table2-row4.pdf", threeplus, width = 3, height = 1)
embedFonts("spark-table2-row4.pdf")
sparktable(osi[osi$nth_order == "More than 3 Prior", c("start_date", "rate")])
osi = sqlQuery(con, "select
start_date
,date_type
,qry_type
,county_cd
,sum(cnt_referrals) cnt_referrals
,sum(prior_order_cnt_households) prior_order_cnt_households
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior') nth_order
from CA_ODS.prtl.rate_referrals_order_specific
where county_cd = 0
and start_date >= '2009-02-01'
group by
start_date
,date_type
,qry_type
,county_cd
,iif(nth_order <= 3, cast(nth_order as varchar(1)), 'More than 3 Prior')
order by
start_date, county_cd, nth_order ")
osi %<>% mutate(prior = factor(nth_order, labels = c("0", "1", "2", "3 or More")),
rate = cnt_referrals / prior_order_cnt_households * 1000)
threeplus = spark(osi[osi$nth_order == "More than 3 Prior", c("start_date", "rate")])
threeplus
ggsave("spark-table2-row4.pdf", threeplus, width = 3, height = 1)
embedFonts("spark-table2-row4.pdf")
sparktable(osi[osi$nth_order == "More than 3 Prior", c("start_date", "rate")])
fortunes::fortune("logistic")
fortunes::fortune("logistic")
fortunes::fortune("logistic")
